# üîç –†–∞–∑–±–æ—Ä `__hash__` –∏ `__eq__` –≤ `dataclass`

–í —ç—Ç–æ–º —Ñ–∞–π–ª–µ –º—ã —Ä–∞–∑–±–∏—Ä–∞–µ–º, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –º–µ—Ç–æ–¥—ã `__hash__` –∏ `__eq__` –≤ Python `dataclass`, –∏ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π –∞—Å–ø–µ–∫—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏ –∏ —Ä–∞–∑–ª–∏—á–∏—è –æ–±—ä–µ–∫—Ç–æ–≤.

## üìå –ö–æ–¥ –∏–∑ –ø—Ä–∏–º–µ—Ä–∞

```python
from abc import ABC
from dataclasses import dataclass, field
from uuid import uuid4

@dataclass(eq=False)
class BaseEntity(ABC):
    oid: str = field(
        default_factory=lambda: str(uuid4()),
        kw_only=True
    )

    def __hash__(self) -> int:
        return hash(self.oid)

    def __eq__(self, __value: 'BaseEntity') -> bool:
        return self.oid == __value.oid
```

## üìú –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –∫–æ–¥–∞

### ‚ùó `eq=False` –≤ `@dataclass`
- –û–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ Python **–Ω–µ** —Å–æ–∑–¥–∞—ë—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–µ—Ç–æ–¥ `__eq__`.
- –ú—ã –¥–æ–ª–∂–Ω—ã –≤—Ä—É—á–Ω—É—é –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç "—Ä–∞–≤–µ–Ω—Å—Ç–≤–æ" –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞.

### üîë `__hash__`
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ö–µ—à –Ω–∞ –æ—Å–Ω–æ–≤–µ `oid`, —á—Ç–æ–±—ã –æ–±—ä–µ–∫—Ç –º–æ–∂–Ω–æ –±—ã–ª–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ `set` –∏ `dict`.
- –†–∞–∑–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º `oid` –±—É–¥—É—Ç –∏–º–µ—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ö–µ—à.

### üîÑ `__eq__`
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ `oid`.
- –î–≤–∞ –æ–±—ä–µ–∫—Ç–∞ —Å—á–∏—Ç–∞—é—Ç—Å—è —Ä–∞–≤–Ω—ã–º–∏ (`==`), –µ—Å–ª–∏ –∏—Ö `oid` —Å–æ–≤–ø–∞–¥–∞—é—Ç.
- –û–¥–Ω–∞–∫–æ —ç—Ç–æ **–Ω–µ –æ–∑–Ω–∞—á–∞–µ—Ç**, —á—Ç–æ –æ–Ω–∏ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –æ–±—ä–µ–∫—Ç –≤ –ø–∞–º—è—Ç–∏ (`is` –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å `False`).

---

## üß† –§–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π –∞—Å–ø–µ–∫—Ç: —Ç–æ–∂–¥–µ—Å—Ç–≤–æ –∏ —Ä–∞–∑–ª–∏—á–∏–µ

–≠—Ç–æ—Ç –∫–æ–¥ –æ—Ç—Ä–∞–∂–∞–µ—Ç —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É:
1. **–°—É—â–Ω–æ—Å—Ç–Ω—ã–º —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ–º** ‚Üí –û–±—ä–µ–∫—Ç—ã –≤—ã–≥–ª—è–¥—è—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏, –Ω–æ –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞–∑–Ω—ã–º–∏ (`is` –Ω–µ —Ä–∞–≤–µ–Ω `True`).
2. **–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã–º —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ–º** ‚Üí –î–≤–∞ –æ–±—ä–µ–∫—Ç–∞ —Å—á–∏—Ç–∞—é—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏, –µ—Å–ª–∏ —É –Ω–∏—Ö –æ–¥–∏–Ω `oid`.

üîπ **–ü—Ä–∏–º–µ—Ä –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω–∏**:
- –î–≤–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –∏–º–µ–Ω–∞–º–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö ‚Äì —ç—Ç–æ —Ä–∞–∑–Ω—ã–µ –ª—é–¥–∏ (—Ä–∞–∑–Ω—ã–µ `oid`).


---

## ‚ùì 1. –ü–æ—á–µ–º—É —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É –ø–∞–º—è—Ç–∏ –Ω–µ –≤—Å–µ–≥–¥–∞ –ø–æ–ª–µ–∑–Ω–æ?

–í Python, –µ—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å `__eq__`, –æ–±—ä–µ–∫—Ç—ã —Å—Ä–∞–≤–Ω–∏–≤–∞—é—Ç—Å—è –ø–æ –∏—Ö **–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É –≤ –ø–∞–º—è—Ç–∏** (`id(obj)`). –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ **–¥–≤–∞ –æ–±—ä–µ–∫—Ç–∞ —Å—á–∏—Ç–∞—é—Ç—Å—è —Ä–∞–∑–Ω—ã–º–∏, –¥–∞–∂–µ –µ—Å–ª–∏ —É –Ω–∏—Ö –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ**.

### üîπ –ü—Ä–∏–º–µ—Ä —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –∏–º–µ–Ω–∞–º–∏:

```python
class Student:
    def __init__(self, name):
        self.name = name

s1 = Student("Alice")
s2 = Student("Alice")

print(s1 == s2)  # False, —Ç.–∫. Python —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –ø–æ id(s1) –∏ id(s2)
```

–•–æ—Ç—è `s1` –∏ `s2` –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ `name`, –æ–Ω–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ —Å—á–∏—Ç–∞—é—Ç—Å—è —Ä–∞–∑–Ω—ã–º–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ **—Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö –≤ –ø–∞–º—è—Ç–∏**.

–í **–Ω–∞—à–µ–º –∫–æ–¥–µ** –º—ã –∑–∞–¥–∞—ë–º **—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ** –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞: –µ—Å–ª–∏ `oid` –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π ‚Üí –æ–±—ä–µ–∫—Ç—ã —Ä–∞–≤–Ω—ã. –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å **–ª–æ–≥–∏—á–µ—Å–∫—É—é —Å—É—â–Ω–æ—Å—Ç—å**, –∞ –Ω–µ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ –ø–∞–º—è—Ç–∏.

---

## ‚ùì 2. –ü–æ—á–µ–º—É –≤ `__eq__` –º—ã –ø–µ—Ä–µ–¥–∞—ë–º `BaseEntity` –∏ —á—Ç–æ –¥–µ–ª–∞–µ—Ç `return self.oid == __value.oid`?

```python
def __eq__(self, __value: "BaseEntity") -> bool:
    return self.oid == __value.oid
```

- –ê—Ä–≥—É–º–µ–Ω—Ç `__value: "BaseEntity"` —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –º–µ—Ç–æ–¥ –æ–∂–∏–¥–∞–µ—Ç **–æ–±—ä–µ–∫—Ç —Ç–æ–≥–æ –∂–µ –∫–ª–∞—Å—Å–∞**.
- `return self.oid == __value.oid` —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç **—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã** –æ–±—ä–µ–∫—Ç–æ–≤.

### üîπ –ü—Ä–∏–º–µ—Ä —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏:

```python
from uuid import uuid4

class BaseEntity:
    def __init__(self, oid=None):
        self.oid = oid or str(uuid4())

    def __eq__(self, __value: "BaseEntity") -> bool:
        return self.oid == __value.oid

# –°–æ–∑–¥–∞–¥–∏–º –¥–≤–∞ –æ–±—ä–µ–∫—Ç–∞ —Å –û–î–ò–ù–ê–ö–û–í–´–ú oid
same_oid = str(uuid4())

obj1 = BaseEntity(oid=same_oid)
obj2 = BaseEntity(oid=same_oid)

print(obj1 == obj2)  # True, —Ç.–∫. oid –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π

# –°–æ–∑–¥–∞–¥–∏–º –¥–≤–∞ –æ–±—ä–µ–∫—Ç–∞ —Å –†–ê–ó–ù–´–ú–ò oid
obj3 = BaseEntity()
obj4 = BaseEntity()

print(obj3 == obj4)  # False, —Ç.–∫. oid —Ä–∞–∑–Ω—ã–µ
```
üõë –ê —á—Ç–æ –µ—Å–ª–∏ –±—ã __eq__ –ù–ï –±—ã–ª –æ–ø—Ä–µ–¥–µ–ª—ë–Ω?

```python
from uuid import uuid4

class BaseEntity:
    def __init__(self, oid=None):
        self.oid = oid or str(uuid4())

# –°–æ–∑–¥–∞–¥–∏–º –¥–≤–∞ –æ–±—ä–µ–∫—Ç–∞ —Å –û–î–ò–ù–ê–ö–û–í–´–ú oid
same_oid = str(uuid4())

obj1 = BaseEntity(oid=same_oid)
obj2 = BaseEntity(oid=same_oid)

print(obj1 == obj2)  # False, —Ç.–∫. —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏–¥—ë—Ç –ø–æ id(obj1) –∏ id(obj2)
```

### üî• –í—ã–≤–æ–¥:
- –î–∞–∂–µ –µ—Å–ª–∏ `obj1` –∏ `obj2` ‚Äî **—Ä–∞–∑–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –≤ –ø–∞–º—è—Ç–∏**, –æ–Ω–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è —Ä–∞–≤–Ω—ã–º–∏ (`==`), –ø–æ—Ç–æ–º—É —á—Ç–æ —É –Ω–∏—Ö –æ–¥–∏–Ω `oid`.
- `obj3` –∏ `obj4` —Ä–∞–∑–Ω—ã–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ –∏—Ö `oid` —É–Ω–∏–∫–∞–ª—å–Ω—ã.

---

## üìå –ò—Ç–æ–≥–æ–≤—ã–µ –≤—ã–≤–æ–¥—ã
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é Python —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç **–æ–±—ä–µ–∫—Ç—ã –ø–æ –∏—Ö —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—é –≤ –ø–∞–º—è—Ç–∏**, —á—Ç–æ –Ω–µ –≤—Å–µ–≥–¥–∞ —É–¥–æ–±–Ω–æ.
- –ú—ã –º–æ–∂–µ–º –∑–∞–¥–∞—Ç—å **—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞**, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ä–∞–≤–Ω–∏–≤–∞—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã (`oid`).
- –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç **—Ä–∞–∑–Ω—ã–º —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º –∫–ª–∞—Å—Å–∞ —Å—á–∏—Ç–∞—Ç—å—Å—è —Ä–∞–≤–Ω—ã–º–∏**, –µ—Å–ª–∏ —É –Ω–∏—Ö –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä.

