## Вопрос:
- #### т.е. сервисы только для общение внутри приложения , всякие utils.py для общения с сервисами? Entrypoints  что к нам извне клиент мог постучаться и что-то сделать как views.py? а Infrastructure  это орм-ка? (для джанго) что используется в Entrypoints  и в Services ?

---

# Структура компонентов в Django проекте на основе DDD

## Services — только для общения внутри приложения

Сервисы (`Services`) содержат бизнес-логику и используются для работы с сущностями и репозиториями внутри приложения. Они обеспечивают взаимодействие между различными компонентами, но не взаимодействуют напрямую с внешними запросами (от клиентов). Эти сервисы позволяют:

- Организовать бизнес-процессы.
- Обрабатывать данные, поступающие от сущностей и репозиториев.
- Выполнять операции, которые затрагивают несколько сущностей.

Например, в Django проекте сервисы могут находиться в папке `logic` и быть вызваны из представлений (`views.py`), когда нужно выполнить какое-то комплексное действие с данными.

### Пример:
```python
# logic/user_service.py

class UserService:
    @staticmethod
    def activate_user(user):
        user.is_active = True
        user.save()
```

Здесь `UserService` предоставляет бизнес-логику для активации пользователя, но сам по себе `UserService` не знает о том, откуда пришел запрос.

## Entrypoints — для взаимодействия с внешним миром

Точки входа (`Entrypoints`) отвечают за взаимодействие с клиентами и внешними системами. В Django `Entrypoints` можно представить в виде файлов `views.py`, которые принимают HTTP-запросы и направляют их в сервисы для выполнения бизнес-логики. Именно точки входа принимают запросы извне (например, от REST API клиента) и используют сервисы для обработки этих запросов.

- `Entrypoints` обрабатывают данные от клиента (например, данные POST-запроса).
- Взаимодействуют с сервисами, передавая им данные для выполнения бизнес-логики.
- Формируют и возвращают ответ клиенту (например, JSON-ответ).

### Пример:
```python
# application/views.py

from rest_framework.views import APIView
from rest_framework.response import Response
from logic.user_service import UserService
from django.contrib.auth.models import User

class ActivateUserView(APIView):
    def post(self, request, user_id):
        user = User.objects.get(id=user_id)
        UserService.activate_user(user)
        return Response({"status": "user activated"})
```

Здесь `ActivateUserView` выполняет роль точки входа: она принимает POST-запрос от клиента и вызывает `UserService` для выполнения логики активации пользователя.

## Infrastructure — для работы с данными (например, ORM)

Инфраструктурный слой (`Infrastructure`) в контексте Django обычно представляет собой взаимодействие с базой данных через ORM (Django Models). Репозитории (`Repositories`) скрывают детали взаимодействия с базой данных и предоставляют удобный интерфейс для работы с сущностями.

- В Django модель (`Model`) можно использовать как инфраструктурный слой, представляя сущности и методы для их сохранения, обновления и удаления.
- `Repositories` могут быть реализованы в виде вспомогательных классов или модулей, оборачивающих доступ к модели.

### Пример:
```python
# infra/user_repository.py

from django.contrib.auth.models import User

class UserRepository:
    @staticmethod
    def get_user_by_id(user_id):
        return User.objects.get(id=user_id)
    
    @staticmethod
    def save_user(user):
        user.save()
```

Здесь `UserRepository` служит интерфейсом для работы с `User`, отделяя детали ORM от бизнес-логики, что позволяет легко заменить базу данных при необходимости.

## Utils (вспомогательные функции) для сервисов

`Utils` (вспомогательные функции) — это функции или модули, которые содержат общие утилитарные методы и не относятся напрямую к бизнес-логике, ORM или точкам входа. Эти функции могут быть вызваны как в `Services`, так и в `Entrypoints`, чтобы упростить или стандартизировать некоторые задачи.

### Пример:
```python
# utils/email_utils.py

from django.core.mail import send_mail

def send_activation_email(user):
    send_mail(
        'Activate your account',
        'Please click the link to activate your account.',
        'no-reply@example.com',
        [user.email],
        fail_silently=False,
    )
```

Функция `send_activation_email` может быть вызвана в сервисе для отправки уведомления, не завися при этом от логики самого сервиса.

## Как всё это связывается

1. **Entrypoints (views.py)** получают запросы от клиента и вызывают сервисы.
2. **Services** выполняют бизнес-логику, используя сущности и репозитории.
3. **Repositories** управляют доступом к данным через ORM, абстрагируя инфраструктурные детали.
4. **Utils** предоставляют общие функции, используемые как в сервисах, так и в точках входа.
5. **Mediator** координирует взаимодействие между командами и их обработчиками, обеспечивая центральную маршрутизацию команд внутри системы.

Такой подход делает код гибким и легко поддерживаемым, так как каждый слой отвечает за свои задачи и может быть изменен независимо от других слоев.
